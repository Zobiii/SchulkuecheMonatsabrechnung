<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:Schulkueche.App.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
        x:Class="Schulkueche.App.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
    Title="Gemeinde-Küche">

    <Design.DataContext>
        <!-- This only sets the DataContext for the previewer in an IDE,
             to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <TabControl SelectionChanged="OnTabSelectionChanged">
        <TabItem Header="Personen">
            <Grid RowDefinitions="* ,Auto">
                <ScrollViewer Grid.Row="0">
                    <StackPanel Spacing="12" Margin="16" DataContext="{Binding Personen}">
                        <TextBox Width="260" Watermark="Suche nach Name..." Text="{Binding FilterText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                        <Border BorderBrush="{DynamicResource ThemeBorderLowBrush}" BorderThickness="1" CornerRadius="6" Padding="12" Background="{DynamicResource ThemeControlLowBrush}">
                            <StackPanel Spacing="10">
                                <TextBlock Text="Person anlegen / bearbeiten" FontWeight="SemiBold"/>
                                <Grid ColumnDefinitions="160,*,Auto,120,Auto,160" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto" ColumnSpacing="12" RowSpacing="8">
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Name:" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="0" Grid.Column="1" Watermark="Vollständiger Name" Text="{Binding Name, Mode=TwoWay}"/>

                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Kategorie:" VerticalAlignment="Center"/>
                                    <ComboBox Grid.Row="1" Grid.Column="1" SelectedIndex="{Binding Category}">
                                        <ComboBoxItem>Pensionist</ComboBoxItem>
                                        <ComboBoxItem>Kindergruppe</ComboBoxItem>
                                        <ComboBoxItem>Gratis</ComboBoxItem>
                                    </ComboBox>

                                    <CheckBox Grid.Row="1" Grid.Column="3" IsChecked="{Binding DefaultDelivery, Mode=TwoWay}" Content="Lieferung?"/>

                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Strasse:" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="2" Grid.Column="1" Watermark="Straßenname" Text="{Binding Street, Mode=TwoWay}"/>
                                    <TextBlock Grid.Row="2" Grid.Column="2" Text="Hsnr:" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="2" Grid.Column="3" Watermark="Nr." Text="{Binding HouseNumber, Mode=TwoWay}"/>

                                    <TextBlock Grid.Row="3" Grid.Column="2" Text="PLZ:" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="3" Grid.Column="3" Watermark="PLZ" Text="{Binding Zip, Mode=TwoWay}"/>
                                    <TextBlock Grid.Row="3" Grid.Column="0" Text="Ort:" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="3" Grid.Column="1" Watermark="Ort" Text="{Binding City, Mode=TwoWay}"/>

                                    <TextBlock Grid.Row="4" Grid.Column="0" Text="Kontakt:" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="4" Grid.Column="1" Watermark="Telefon / E‑Mail" Text="{Binding Contact, Mode=TwoWay}"/>

                                    <TextBlock Grid.Row="5" Grid.Column="0" Text="Indiv. Essenspreis (€):" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="5" Grid.Column="1" Watermark="Leer lassen für Standardpreis" Text="{Binding CustomMealPriceText, Mode=TwoWay}"/>
                                </Grid>

                                <StackPanel Orientation="Horizontal" Spacing="12">
                                    <Button Content="Speichern" Command="{Binding SpeichernCommand}"/>
                                    <Button Content="Neu" Command="{Binding NeuCommand}"/>
                                    <Button Content="Aktualisieren" Command="{Binding AktualisierenCommand}"/>
                                    <Button Content="Löschen" Command="{Binding LoeschenCommand}"/>
                                    <TextBlock Text="{Binding Status}" Foreground="Gray" VerticalAlignment="Center"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <TextBlock Margin="0,16,0,4" Text="Vorhandene Personen" FontWeight="SemiBold"/>
                        <Border BorderBrush="{DynamicResource ThemeBorderLowBrush}" BorderThickness="1" CornerRadius="6">
                            <ListBox ItemsSource="{Binding GefiltertePersonen}" SelectedItem="{Binding SelectedPerson, Mode=TwoWay}" Height="240">
                                <ListBox.Styles>
                                    <Style Selector="ListBox > ListBoxItem:nth-child(odd)">
                                        <Setter Property="Background" Value="#12FFFFFF"/>
                                    </Style>
                                </ListBox.Styles>
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Border Padding="8,6" BorderThickness="0,0,0,1" BorderBrush="{DynamicResource ThemeBorderLowBrush}">
                                            <TextBlock Text="{Binding Name}"/>
                                        </Border>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
                <TextBlock Grid.Row="1" Margin="8,4" FontSize="10" Foreground="Gray" HorizontalAlignment="Left"
                           Text="Developed by Lechner Tobias v1.0.3.0 / Code: https://github.com/Zobiii/SchulkuecheMonatsabrechnung"/>
            </Grid>
        </TabItem>

        <TabItem x:Name="ErfassungTab" Header="Schnellerfassung">
            <Grid RowDefinitions="Auto,* ,Auto">
            <StackPanel Grid.Row="0" Spacing="8" Margin="12" DataContext="{Binding Erfassung}">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="Datum:" VerticalAlignment="Center"/>
                    <DatePicker SelectedDate="{Binding SelectedDate, Mode=TwoWay}"/>
                    <Button Content="Heute" Command="{Binding HeuteCommand}"/>
                    <Button Content="Alle Mengen = 0" Command="{Binding AlleMengenNullCommand}"/>
                    <Button Content="Lieferung zurücksetzen" Command="{Binding ResetLieferungCommand}"/>
                    <Button Content="Speichern" Command="{Binding SpeichernCommand}"/>
                </StackPanel>

                <ScrollViewer Grid.Row="1" Height="400">
                    <ListBox x:Name="ErfassungList" ItemsSource="{Binding Zeilen}" SelectionMode="Single">
                        <ListBox.Styles>
                            <!-- zebra stripes: very light overlay on odd rows -->
                            <Style Selector="ListBox#ErfassungList > ListBoxItem:nth-child(odd)">
                                <Setter Property="Background" Value="#10FFFFFF"/>
                            </Style>
                        </ListBox.Styles>

                        <ListBox.ItemTemplate>
                            <DataTemplate x:DataType="vm:ErfassungViewModel+Row">
                                <Border Padding="4" BorderThickness="0,0,0,1" BorderBrush="{DynamicResource ThemeBorderLowBrush}">
                                    <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="8" VerticalAlignment="Center">
                                        <TextBlock Grid.Column="0" Text="{Binding DisplayName}"/>
                                        <NumericUpDown Grid.Column="1" Width="100" Minimum="0" Maximum="50" Value="{Binding Quantity, Mode=TwoWay}"/>
                                        <CheckBox Grid.Column="2" Content="Lieferung?" IsChecked="{Binding Delivery, Mode=TwoWay}"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </ScrollViewer>

                <TextBlock Text="{Binding Status}" Foreground="Gray"/>
            </StackPanel>
            <TextBlock Grid.Row="2" Margin="8,4" FontSize="10" Foreground="Gray" HorizontalAlignment="Left"
                       Text="Developed by Lechner Tobias v1.0.3.0 / Code: https://github.com/Zobiii/SchulkuecheMonatsabrechnung"/>
            </Grid>
        </TabItem>

        <TabItem Header="Abrechnung">
            <Grid RowDefinitions="Auto,* ,Auto">
            <StackPanel Grid.Row="0" Spacing="8" Margin="12" DataContext="{Binding Abrechnung}">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="Monat:" VerticalAlignment="Center"/>
                    <NumericUpDown Minimum="1" Maximum="12" Value="{Binding Monat, Mode=TwoWay}"/>
                    <TextBlock Text="Jahr:" VerticalAlignment="Center"/>
                    <NumericUpDown Minimum="2024" Maximum="2100" Value="{Binding Jahr, Mode=TwoWay}"/>
                    <Button Content="Berechnen" Command="{Binding BerechnenCommand}"/>
                    <Button Content="PDF exportieren" Command="{Binding ExportPdfCommand}" IsEnabled="{Binding KannExportieren}"/>
                </StackPanel>
                <ListBox Grid.Row="1" ItemsSource="{Binding Zeilen}" Height="400"/>
                <StackPanel Orientation="Vertical" Spacing="4">
                    <TextBlock Text="Summen" FontWeight="Bold"/>
                    <TextBlock Text="{Binding SummePensionisten, StringFormat='Pensionisten: {0:C}'}"/>
                    <TextBlock Text="{Binding SummeKinder, StringFormat='Kinder: {0:C}'}"/>
                    <TextBlock Text="{Binding SummeGratis, StringFormat='Gratis: {0:C}'}"/>
                    <TextBlock Text="{Binding SummeGesamt, StringFormat='Gesamt: {0:C}'}" FontWeight="Bold"/>
                </StackPanel>
                <TextBlock Text="{Binding Status}" Foreground="Gray"/>
            </StackPanel>
            <TextBlock Grid.Row="2" Margin="8,4" FontSize="10" Foreground="Gray" HorizontalAlignment="Left"
                       Text="Developed by Lechner Tobias v1.0.3.0 / Code: https://github.com/Zobiii/SchulkuecheMonatsabrechnung"/>
            </Grid>
        </TabItem>
    </TabControl>

</Window>
